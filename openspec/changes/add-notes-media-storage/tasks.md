## 1. 设计文件存储架构

- [ ] 1.1 确定应用数据目录结构（使用 Tauri app_data_dir）
- [ ] 1.2 设计媒体文件命名规则和目录组织方式
- [ ] 1.3 设计文件路径引用格式（相对路径 vs 绝对路径）
- [ ] 1.4 设计文件清理策略（删除模板时清理未使用的媒体文件）

## 2. 实现 Rust 后端文件操作

- [ ] 2.1 在 `Cargo.toml` 中添加 `tauri-plugin-fs` 依赖
- [ ] 2.2 在 `lib.rs` 中注册文件系统插件
- [ ] 2.3 实现保存媒体文件的 Tauri 命令
- [ ] 2.4 实现读取媒体文件的 Tauri 命令
- [ ] 2.5 实现删除媒体文件的 Tauri 命令（用于清理）

## 3. 实现前端文件服务

- [ ] 3.1 在 `tauri-service.js` 中添加 `saveMediaFile` 函数
- [ ] 3.2 在 `tauri-service.js` 中添加 `readMediaFile` 函数
- [ ] 3.3 在 `tauri-service.js` 中添加 `getMediaUrl` 函数（将路径转换为可访问的 URL）
- [ ] 3.4 实现文件哈希计算（用于去重和命名）

## 4. 修改注释数据模型

- [ ] 4.1 设计注释 HTML 中的媒体路径格式（如 `<img src="media://templateId_filename.jpg">`）
- [ ] 4.2 实现 HTML 解析，提取媒体文件路径
- [ ] 4.3 实现 HTML 生成，将媒体路径转换为可访问的 URL
- [ ] 4.4 更新注释保存逻辑，保存路径而非 base64

## 5. 实现剪切板粘贴支持

- [ ] 5.1 在 `NotesEditor` 中添加 Tiptap 粘贴事件监听
- [ ] 5.2 检测粘贴内容中的图片数据（Clipboard API）
- [ ] 5.3 检测粘贴内容中的视频数据
- [ ] 5.4 自动保存粘贴的媒体文件到应用目录
- [ ] 5.5 在编辑器中插入文件路径引用

## 6. 修改图片/视频插入功能

- [ ] 6.1 修改 `NotesToolbar` 中的图片选择逻辑，保存文件而非 base64
- [ ] 6.2 修改 `NotesToolbar` 中的视频选择逻辑，保存文件而非直接路径
- [ ] 6.3 更新插入的 HTML，使用文件路径引用格式

## 7. 修复模板切换问题

- [ ] 7.1 检查 `NotesEditor` 中模板切换时的注释加载逻辑
- [ ] 7.2 确保 `templateId` prop 变化时正确更新编辑器内容
- [ ] 7.3 验证切换模板时媒体文件正确加载和显示

## 8. 实现媒体文件加载和显示

- [ ] 8.1 实现路径到 URL 的转换逻辑（Tauri 环境）
- [ ] 8.2 实现浏览器模式的降级方案（使用 Blob URL）
- [ ] 8.3 确保图片和视频在编辑器中正确显示
- [ ] 8.4 处理文件不存在的情况（显示占位符或错误提示）

## 9. 数据迁移和兼容性

- [ ] 9.1 设计现有 base64 注释的迁移策略
- [ ] 9.2 实现迁移函数，将 base64 转换为文件存储
- [ ] 9.3 添加兼容性检查，支持旧格式的读取

## 10. 测试和验证

- [ ] 10.1 测试图片文件保存和加载
- [ ] 10.2 测试视频文件保存和加载
- [ ] 10.3 测试剪切板粘贴功能
- [ ] 10.4 测试模板切换时注释加载
- [ ] 10.5 测试文件清理功能
- [ ] 10.6 验证性能提升（数据文件大小减少）
