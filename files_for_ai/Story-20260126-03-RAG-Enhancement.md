# Story-20260126-03: RAG (检索增强生成) 知识库管理

## 1. 痛点分析
用户在处理特定领域的任务时，需要向 AI 提供大量参考资料。目前手动“复制-粘贴”的方式效率极低，且受限于大模型的上下文窗口长度。用户需要一种方式，让 AI 能够像翻阅字典一样，按需从其私有文档中检索相关信息。

## 2. 核心需求

### 2.1 知识库工作区 (Knowledge Workspace)
- **需求**：提供一个独立的空间来管理用户的参考文档。
- **功能点**：
    - 支持导入 PDF, Markdown, TXT, HTML 等格式。
    - 文档版本管理：支持更新已上传文档，并自动重新索引。
    - 状态监控：展示文档的解析状态、Token 消耗以及向量化进度。

### 2.2 自动索引引擎 (Indexing Engine)
- **需求**：将非结构化文档转化为 AI 可检索的向量数据。
- **功能点**：
    - **智能切片 (Chunking)**：根据标题、段落等逻辑结构自动拆分文本，避免上下文丢失。
    - **本地向量化支持**：为了隐私，支持在本地调用轻量级模型（如 BERT 系列）生成 Embedding，或通过 API 调用（如 OpenAI/Gemini Embedding）。
    - 存储：在客户端本地集成 SQLite-vss 或类似的向量存储组件。

### 2.3 语义检索注入 (Semantic Search & Injection)
- **需求**：在发送 Prompt 前，自动检索最相关的片段并拼接到 Context 中。
- **功能点**：
    - 在 Prompt 模板中新增 `@KnowledgeBase` 引用标记。
    - 实时预览：展示检索到的 Top-K 相关片段，并允许用户手动微调。
    - **溯源功能 (Citations)**：AI 生成的内容必须标注出处，点击标注可跳转到文档的具体页码或段落。

## 3. 用户场景示例
- **场景**：基于公司合同模板起草新协议。
- **流程**：
    1. 用户建立名为“合同模板库”的知识库。
    2. 用户在提示词中输入：“参考 @合同模板库，为项目 X 起草一份技术服务协议”。
    3. 系统自动检索出最相似的模板和风险提示条款。
    4. AI 生成协议内容，并标注引用了哪些模板条款。
